(this["webpackJsonpempty-react"]=this["webpackJsonpempty-react"]||[]).push([[0],{157:function(e,t,a){},158:function(e,t,a){},159:function(e,t,a){},160:function(e,t,a){},161:function(e,t,a){},162:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(25),s=a.n(r),c=(a(105),a(12)),l=a.n(c),o=a(18),u=a(3),d=a(4),h=a(13),f=a(10),m=a(9),p=a(32),v=a(20),b=a(87),j=a.n(b),g=a(14),O=a.n(g),y=(a(118),{settings:{},appVersion:0,getCurrentUser:function(){},initAppSettings:function(){var e=Object(o.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setAppSettings:function(){var e=Object(o.a)(l.a.mark((function e(t,a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),updateComplete:function(){},access:function(e){},setHeaderVisibility:function(e){}}),x=i.a.createContext(y),N=a.p+"static/media/user-default-avatar.fe75c8d0.svg",S=a(1),k=function(){function e(t){var a,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(u.a)(this,e),this.id=void 0,this.NAME="",this.LAST_NAME="",this.SECOND_NAME="",this.EMAIL="",this.PERSONAL_PHOTO="",this.WORK_POSITION="",this.PERSONAL_MOBILE="",this.admin=!1,Object.assign(this,t),this.id=parseInt(null!==(a=null===t||void 0===t?void 0:t.ID)&&void 0!==a?a:null===t||void 0===t?void 0:t.id)||0,this.admin=n}return Object(d.a)(e,[{key:"Id",get:function(){return this.id}},{key:"Link",get:function(){return"https://".concat(F.getDomain(),"/company/personal/user/").concat(this.Id,"/")}},{key:"LinkView",get:function(){var e=this;return Object(S.jsxs)("a",{href:e.Link,target:"_blank",title:e.FullName,children:[e.Photo?Object(S.jsx)("span",{className:"tasks-grid-avatar",style:{backgroundImage:"url(".concat(e.Photo,")")}}):Object(S.jsx)("span",{className:"tasks-grid-avatar bg-dark",style:{backgroundImage:"url(".concat(N,")")}}),e.FullName]})}},{key:"LinkIconView",get:function(){var e=this;return Object(S.jsx)("a",{href:e.Link,target:"_blank",title:e.FullName,children:e.Photo?Object(S.jsx)("span",{className:"tasks-grid-avatar",style:{backgroundImage:"url(".concat(e.Photo,")")}}):Object(S.jsx)("span",{className:"tasks-grid-avatar bg-dark",style:{backgroundImage:"url(".concat(N,")")}})})}},{key:"Photo",get:function(){return!!(this.PERSONAL_PHOTO&&this.PERSONAL_PHOTO.length>0)&&this.PERSONAL_PHOTO}},{key:"Position",get:function(){return this.WORK_POSITION}},{key:"FullName",get:function(){return this.NAME&&this.NAME.length>0?this.LAST_NAME&&this.LAST_NAME.length>0?this.NAME+" "+this.LAST_NAME:this.NAME:this.EMAIL&&this.EMAIL.length>0?this.EMAIL:"ID: "+this.Id}},{key:"isAdmin",get:function(){return this.admin}}]),e}(),T=function(){function e(){Object(u.a)(this,e),this.domain="",this.cache={},this.resizeTimestamp=0,this.scrollSize={},this.initComplete=!1,this.placementInformation=!1}return Object(d.a)(e,[{key:"appCache",value:function(e,t){if("undefined"===typeof t)return this.cache[e];this.cache[e]=t}},{key:"clearCacheDocument",value:function(e){this.appCache(E.KeyForDocument(e),null)}},{key:"clearCacheUser",value:function(e){this.appCache(E.KeyForUser(e),null)}},{key:"installComplete",value:function(){var e=window.BX24||!1;e&&e.installFinish()}},{key:"getDomain",value:function(){return this.domain}},{key:"getLang",value:function(){return"ru"===this.lang?"ru":"en"}},{key:"isInitComplete",value:function(){return this.initComplete}},{key:"getAuth",value:function(){var e=window.BX24||!1;if(e)return e.getAuth()}},{key:"init",value:function(){var e=this;return new Promise((function(t,a){var n=window.BX24||!1;n?n.init((function(){e.initComplete=!0,e.domain=n.getDomain(),e.lang=n.getLang(),e.placementInformation=n.placement.info(),n.callMethod("user.current",{},(function(e){if(e.error())console.error("error-get-current-user",e.error()),a();else{var i=new k(e.data(),n.isAdmin());t(i)}}))})):a()}))}},{key:"resizeFrame",value:function(){var e=this,t=(new Date).getTime();this.resizeTimestamp=t,setTimeout((function(){e.tryResize(t)}),300)}},{key:"tryResize",value:function(e){var t=window.BX24||!1;if(t){this.resizeTimestamp===e&&t.fitWindow()}}},{key:"callBatch",value:function(e,t){var a=window.BX24||!1;a&&a.callBatch(e,(function(e){t(e)}))}},{key:"prepareResult",value:function(e,t){Array.isArray(t)?t.forEach((function(t){e.push(t)})):t.documents&&Array.isArray(t.documents)?t.documents.forEach((function(t){e.push(t)})):e.push(t)}},{key:"callMethod",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this;return new Promise((function(i,r){var s=window.BX24||!1;if(s){var c=[];s.callMethod(e,t,(function(e){if(e.error())r(e.error());else{var t=e.data();n.prepareResult(c,t),a?e.more()?e.next():i({items:c}):i({items:c,total:e.total()})}}))}else r()}))}},{key:"scrollParentWindow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=window.BX24||!1;t&&t.scrollParentWindow(e)}},{key:"placementInfo",value:function(){return this.placementInformation}},{key:"removePlacementOption",value:function(e){delete this.placementInformation.options[e]}},{key:"getUsers",value:function(e){var t=this;return new Promise((function(a,n){e=e.filter((function(e){return e>0}));var i={},r=[];e.forEach((function(e){var a=t.appCache(E.KeyForUser(e));a?i[e]=a:r.push(e)})),r.length<1?a(i):t.callMethod("user.get",{ID:r},!0).then((function(e){e.items.forEach((function(e){var a=new k(e,F.getDomain());t.appCache(E.KeyForUser(a.Id),a),i[a.Id]=a})),a(i)})).catch((function(e){n(e)}))}))}}]),e}(),E=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,null,[{key:"KeyForUser",value:function(e){return"User_".concat(e)}},{key:"KeyForDocument",value:function(e){return"Document_".concat(e)}}]),e}(),F=new T,C=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(u.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).refreshTable=function(){e.table&&e.table.current&&e.table.current.tryLoadData()},e}return Object(d.a)(a,[{key:"render",value:function(){return F.callMethod("crm.deal.list",null).then((function(e){return console.log(e)})).catch((function(e){return console.error(e)})),Object(S.jsx)("div",{children:"Main Page 123"})}}]),a}(i.a.Component);C.contextType=x;var I=a(96),P=a(19),A=a(166),w=a(22),R=a(42),D=a(63),M=a.n(D),L=a(24),V=a(49),U={Hidden:"hidden",Text:"text",Select:"select",UserSelect:"user-select",ContactSelect:"contact-select",DateRange:"date-range",NumberRange:"number-range"},_={value:!1,filterItem:{},onChange:function(){},language:""},q=i.a.createContext(_),Y="greater",B="less",H="range",K="period",J="today",G="yesterday",X="week",z="month",W=function(){return[{id:"greater",name:"filter-range-type-greater"},{id:"less",name:"filter-range-type-less"},{id:"range",name:"filter-range-type-range"}]},Q=function(){return[{id:"period",name:"filter-range-type-period"},{id:"greater",name:"filter-range-type-greater"},{id:"less",name:"filter-range-type-less"},{id:"range",name:"filter-range-type-range"}]},Z=function(){return[{id:"today",name:"date-today"},{id:"yesterday",name:"date-yesterday"},{id:"week",name:"date-week"},{id:"month",name:"date-month"}]},$=a(97),ee=a(89),te=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this))._selectProgramFocus=function(){n.setState({selectActive:!0})},n._selectProgramBlur=function(){n.setState({selectActive:!1})},n._selectOnChange=function(e,t){n.props.onChange&&n.props.onChange(e,t)},n.state={selectActive:!1},n}return Object(d.a)(a,[{key:"render",value:function(){var e=this.props,t=e.required,a=e.title,n=(e.onChange,Object($.a)(e,["required","title","onChange"]));return Object(S.jsxs)(i.a.Fragment,{children:[Object(S.jsx)(ee.a,Object(P.a)(Object(P.a)({},n),{},{cacheOptions:!0,isClearable:!0,placeholder:"",onInputChange:this._selectInputChange,required:t,onChange:this._selectOnChange,onFocus:this._selectProgramFocus,onBlur:this._selectProgramBlur})),a&&Object(S.jsx)("label",{className:"select-label ".concat(this.props.value||this.state.selectActive?"active":""),children:Object(S.jsx)(A.a,{children:a})}),t&&Object(S.jsx)("input",{tabIndex:-1,autoComplete:"off",style:{opacity:0,width:"100%",height:0,position:"absolute"},defaultValue:this.props.value?"Y":"",required:!0})]})}}]),a}(i.a.Component),ae=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this)).loadAction=function(e,t){var a=Object(h.a)(n),i=(new Date).getTime();a.loadTimestamp=i,a.setState({loading:!0}),setTimeout((function(){if(a.loadTimestamp===i){if(!e||e.length<1)return a.setState({loading:!1}),void t([]);var n=[],r={name:["user.search",{ACTIVE:"Y",FIND:e}],email:["user.search",{ACTIVE:"Y",EMAIL:"%".concat(e,"%")}]};F.callBatch(r,(function(e){Object.keys(e).forEach((function(t){e[t].error()||e[t].data().forEach((function(e){var t=new k(e);n.push({value:t.Id,label:t.FullName})}))})),a.setState({loading:!1}),t(n)}))}}),a.delay)},n.state={loading:!1},n.delay=500,n.loadTimestamp=0,n}return Object(d.a)(a,[{key:"render",value:function(){return Object(S.jsx)(te,{className:"react-select",defaultOptions:!0,title:this.props.title,value:this.props.value,loadOptions:this.loadAction,onChange:this.props.onChange,required:this.props.required,isMulti:this.props.isMulti,isDisabled:this.props.isDisabled})}}]),a}(i.a.Component),ne=function(){function e(t){Object(u.a)(this,e),Object.assign(this,t)}return Object(d.a)(e,[{key:"Id",get:function(){return parseInt(this.ID)||0}},{key:"Link",get:function(){return"https://".concat(F.getDomain(),"/crm/deal/details/").concat(this.Id,"/")}},{key:"Name",get:function(){return this.TITLE}},{key:"ResponsibleId",get:function(){return parseInt(this.ASSIGNED_BY_ID)||0}},{key:"ContactId",get:function(){return parseInt(this.CONTACT_ID)||0}}]),e}(),ie=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this)).loadAction=function(e,t){var a=Object(h.a)(n),i=(new Date).getTime();a.loadTimestamp=i,a.setState({loading:!0}),setTimeout((function(){if(a.loadTimestamp===i){if(!e||e.lenght<1)return a.setState({loading:!1}),void t([]);var n=[],r={filter:{"%TITLE":e}};F.callMethod("crm.deal.list",r).then((function(e){e.items.forEach((function(e){var i=new ne(e);n.push({value:i.Id,label:i.Name,object:i}),a.setState({loading:!1}),t(n)}))})).catch((function(e){t([])}))}}),a.delay)},n.state={loading:!1},n.delay=500,n.loadTimestamp=0,n}return Object(d.a)(a,[{key:"render",value:function(){return Object(S.jsx)(te,{className:"react-select",defaultOptions:!0,title:this.props.title,value:this.props.value,loadOptions:this.loadAction,onChange:this.props.onChange,required:this.props.required,isMulti:this.props.isMulti,isDisabled:this.props.isDisabled})}}]),a}(i.a.Component),re=function(){function e(t){Object(u.a)(this,e),Object.assign(this,t)}return Object(d.a)(e,[{key:"Id",get:function(){return parseInt(this.ID)||0}},{key:"Link",get:function(){return"https://".concat(F.getDomain(),"/crm/contact/details/").concat(this.Id,"/")}},{key:"FullName",get:function(){return this.NAME&&this.NAME.length>0?this.LAST_NAME&&this.LAST_NAME.length>0?this.NAME+" "+this.LAST_NAME:this.NAME:this.EMAIL&&this.EMAIL.length>0?this.EMAIL:"ID: "+this.Id}}]),e}(),se=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this)).loadAction=function(e,t){var a=Object(h.a)(n),i=(new Date).getTime();a.loadTimestamp=i,a.setState({loading:!0}),setTimeout((function(){if(a.loadTimestamp===i){if(!e||e.length<1)return a.setState({loading:!1}),void t([]);var n=[],r={email:["crm.contact.list",{filter:{EMAIL:e}}],name:["crm.contact.list",{filter:{"%NAME":e}}],lastName:["crm.contact.list",{filter:{"%LAST_NAME":e}}]};F.callBatch(r,(function(e){Object.keys(e).forEach((function(t){e[t].error()||e[t].data().forEach((function(e){var t=new re(e);n.find((function(e){return e.value===t.Id}))||n.push({value:t.Id,label:t.FullName})}))})),a.setState({loading:!1}),t(n)}))}}),a.delay)},n.state={loading:!1},n.delay=500,n.loadTimestamp=0,n}return Object(d.a)(a,[{key:"render",value:function(){return Object(S.jsx)(te,{className:"react-select",defaultOptions:!0,title:this.props.title,value:this.props.value,loadOptions:this.loadAction,onChange:this.props.onChange,required:this.props.required,isMulti:this.props.isMulti,isDisabled:this.props.isDisabled})}}]),a}(i.a.Component),ce=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){return Object(S.jsxs)("div",{className:"",children:[this.context.filterItem.Type===U.Text&&Object(S.jsx)(le,{}),this.context.filterItem.Type===U.NumberRange&&Object(S.jsx)(oe,{}),this.context.filterItem.Type===U.DateRange&&Object(S.jsx)(ue,{}),this.context.filterItem.Type===U.Select&&Object(S.jsx)(de,{}),this.context.filterItem.Type===U.UserSelect&&Object(S.jsx)(he,{}),this.context.filterItem.Type===U.DealSelect&&Object(S.jsx)(fe,{}),this.context.filterItem.Type===U.ContactSelect&&Object(S.jsx)(me,{})]})}}]),a}(i.a.Component);ce.contextType=q;var le=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this)).onChangeValue=function(e){var t=[],a=[];e.target.value&&e.target.value.length>0&&(t.push(e.target.value),a.push(e.target.value)),n.setState({value:t,description:a},n.onChange)},n.state={value:[],description:[]},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.context.value;this.setState({value:e&&e.value?e.value:[]})}},{key:"onChange",value:function(){var e=Object(P.a)({},this.state);this.context.onChange(e,this.context.filterItem)}},{key:"render",value:function(){var e=this.context.filterItem,t=this.state.value.length>0;return Object(S.jsxs)("div",{className:"md-form md-outline m-0",children:[Object(S.jsx)("input",{type:"text",className:"form-control mb-0",value:this.state.value.length>0?this.state.value[0]:"",onChange:this.onChangeValue}),Object(S.jsx)("label",{className:t?"active":"","data-l10n-id":e.Title})]})}}]),a}(i.a.Component);le.contextType=q;var oe=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this)).onChangeType=function(e){n.setState({type:e.target.value},n.onChange)},n.onChangeFrom=function(e){n.setState({from:!!e.target.value&&e.target.value},n.onChange)},n.onChangeTo=function(e){n.setState({to:!!e.target.value&&e.target.value},n.onChange)},n.onChangeValue=function(e){n.setState({value:!!e.target.value&&e.target.value},n.onChange)},n.onChangePeriod=function(e){var t="",a=[];Array.from(e.target.selectedOptions,(function(e){e.value&&e.value.length>0&&(t=e.value,a.push(e.text))})),n.setState({period:!!(t&&t.length>0)&&t,description:a},n.onChange)},n.state={type:"",from:!1,to:!1,value:!1,description:[]},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.context.value;this.dataParam=this.context.filterItem.DataParams?this.context.filterItem.DataParams.join(" "):"",this.setState({type:e&&e.type?e.type:H,from:!(!e||!1===e.from)&&e.from,to:!(!e||!1===e.to)&&e.to,value:!(!e||!1===e.value)&&e.value,period:!(!e||!e.period)&&e.period})}},{key:"onChange",value:function(){var e=Object(P.a)({},this.state);if(e.type===H&&(e.value=!1,e.period=!1,e.from&&e.to?e.description=["".concat(e.from," - ").concat(e.to)]:(e.from&&(e.description=["> ".concat(e.from)]),e.to&&(e.description=["< ".concat(e.to)]))),e.type!==H&&(e.from=!1,e.to=!1,e.period=!1,e.value))switch(e.type){case Y:e.description=["> ".concat(e.value)];break;case B:e.description=["< ".concat(e.value)];break;default:e.description=["".concat(e.value)]}this.context.onChange(e,this.context.filterItem)}},{key:"render",value:function(){var e=this.context.filterItem;return Object(S.jsxs)("div",{className:"md-form md-outline m-0 filter-range",children:[Object(S.jsx)("label",{className:"active","data-l10n-id":e.Title}),Object(S.jsxs)("div",{className:"form-row",children:[Object(S.jsx)("div",{className:"col-7 col-xl-4 mb-2 mb-xl-0",children:Object(S.jsx)("select",{className:"browser-default custom-select",value:this.state.type,onChange:this.onChangeType,children:W().map((function(e){return Object(S.jsx)("option",{value:e.id,"data-l10n-id":e.name},e.id)}))})}),this.state.type===H&&Object(S.jsxs)(i.a.Fragment,{children:[Object(S.jsx)("div",{className:"col-6 col-xl-4 mt-2 mt-xl-0",children:Object(S.jsxs)("div",{className:"from",children:[Object(S.jsx)("input",Object(P.a)({type:"number",className:"form-control mb-0",name:"".concat(e.Name,"_from"),id:"f-".concat(e.Name,"-from"),onChange:this.onChangeFrom,value:"".concat(!1!==this.state.from?this.state.from:"")},this.dataParam)),Object(S.jsx)("label",{className:this.state.from?"active":"",htmlFor:"f-".concat(e.Name,"-from"),"data-l10n-id":"main-from"})]})}),Object(S.jsx)("div",{className:"col-6 col-xl-4 mt-2 mt-xl-0",children:Object(S.jsxs)("div",{className:"to",children:[Object(S.jsx)("input",Object(P.a)({type:"number",className:"form-control mb-0",name:"".concat(e.Name,"_to"),id:"f-".concat(e.Name,"-to"),onChange:this.onChangeTo,value:"".concat(!1!==this.state.to?this.state.to:"")},this.dataParam)),Object(S.jsx)("label",{className:this.state.to?"active":"",htmlFor:"f-".concat(e.Name,"-to"),"data-l10n-id":"main-to"})]})})]}),this.state.type!==H&&Object(S.jsx)("div",{className:"col-12 col-xl-8 mt-2 mt-xl-0",children:Object(S.jsx)("input",Object(P.a)({type:"number",className:"form-control mb-0",name:e.Name,id:"f-".concat(e.Name),onChange:this.onChangeValue,value:"".concat(!1!==this.state.value?this.state.value:"")},this.dataParam))})]})]})}}]),a}(i.a.Component);oe.contextType=q;var ue=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this)).onChangeType=function(e){n.setState({type:e},n.onChange)},n.onChangeFrom=function(e){n.setState({from:!!e.target.value&&e.target.value},n.onChange)},n.onChangeTo=function(e){n.setState({to:!!e.target.value&&e.target.value},n.onChange)},n.onChangeValue=function(e){n.setState({value:!!e.target.value&&e.target.value},n.onChange)},n.onChangePeriod=function(e){n.setState({period:e},n.onChange)},n.state={type:"",from:!1,to:!1,value:!1,description:[]},n.typeOptions=[],Q().forEach((function(e){n.typeOptions.push({value:e.id,label:w.a.t(e.name)})})),n.periodOptions=[],Z().forEach((function(e){n.periodOptions.push({value:e.id,label:w.a.t(e.name)})})),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.context.value;this.dataParam=this.context.filterItem.DataParams?this.context.filterItem.DataParams.join(" "):"";var t=e&&e.type?e.type:H,a=e&&e.period?e.period:J;this.setState({type:this.typeOptions.find((function(e){return e.value===t})),from:!(!e||!e.from)&&e.from,to:!(!e||!e.to)&&e.to,value:!(!e||!e.value)&&e.value,period:this.periodOptions.find((function(e){return e.value===a}))})}},{key:"onChange",value:function(){var e=Object(P.a)({},this.state);if(e.type=e.type.value,e.type===H&&(e.value=!1,e.period=!1,e.from&&e.to?e.description=["".concat(new Date(e.from).toLocaleDateString(this.context.language)," - ").concat(new Date(e.to).toLocaleDateString(this.context.language))]:(e.from&&(e.description=["> ".concat(new Date(e.from).toLocaleDateString(this.context.language))]),e.to&&(e.description=["< ".concat(new Date(e.to).toLocaleDateString(this.context.language))]))),e.type===K&&(e.value=!1,e.from=!1,e.to=!1,e.period&&(e.description=[e.period.label],e.period=e.period.value)),e.type!==H&&e.type!==K&&(e.from=!1,e.to=!1,e.period=!1,e.value))switch(e.type){case Y:e.description=["> ".concat(new Date(e.value).toLocaleDateString(this.context.language))];break;case B:e.description=["< ".concat(new Date(e.value).toLocaleDateString(this.context.language))];break;default:e.description=["".concat(new Date(e.value).toLocaleDateString(this.context.language))]}this.context.onChange(e,this.context.filterItem)}},{key:"render",value:function(){var e=this.context.filterItem;return Object(S.jsxs)("div",{className:"filter-range",children:[Object(S.jsx)("label",{className:"active",children:Object(S.jsx)(A.a,{children:e.Title})}),Object(S.jsxs)("div",{className:"row",children:[Object(S.jsx)("div",{className:"col-7 col-xl-4",children:Object(S.jsx)(V.a,{value:this.state.type,onChange:this.onChangeType,options:this.typeOptions})}),this.state.type.value===H&&Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)("div",{className:"col-6 col-xl-4 mt-2 mt-xl-0",children:Object(S.jsx)(L.g,Object(P.a)(Object(P.a)({type:"date",max:"2100-01-01",onChange:this.onChangeFrom,value:"".concat(!1!==this.state.from?new Date(this.state.from).toISOString().slice(0,10):"")},this.dataParam),{},{placeholder:w.a.t("filter-field-input-date-placeholder")}))}),Object(S.jsx)("div",{className:"col-6 col-xl-4 mt-2 mt-xl-0",children:Object(S.jsx)(L.g,Object(P.a)(Object(P.a)({type:"date",max:"2100-01-01",onChange:this.onChangeTo,value:"".concat(!1!==this.state.to?new Date(this.state.to).toISOString().slice(0,10):"")},this.dataParam),{},{placeholder:w.a.t("filter-field-input-date-placeholder")}))})]}),this.state.type.value===K&&Object(S.jsx)("div",{className:"col-12 col-xl-8 mt-2 mt-xl-0",children:Object(S.jsxs)("div",{className:"form-outline",children:[Object(S.jsx)(V.a,{value:this.state.period,onChange:this.onChangePeriod,options:this.periodOptions}),Object(S.jsx)("label",{className:"select-label ".concat(this.state.period?"active":""),children:Object(S.jsx)(A.a,{children:"filter-range-type-period"})})]})}),this.state.type.value!==H&&this.state.type.value!==K&&Object(S.jsx)("div",{className:"col-12 col-xl-8 mt-2 mt-xl-0",children:Object(S.jsx)(L.g,Object(P.a)(Object(P.a)({type:"date",name:e.Name,id:"f-".concat(e.Name),max:"2100-01-01",onChange:this.onChangeValue,value:"".concat(!1!==this.state.value?new Date(this.state.value).toISOString().slice(0,10):"")},this.dataParam),{},{placeholder:w.a.t("filter-field-input-date-placeholder")}))})]})]})}}]),a}(i.a.Component);ue.contextType=q;var de=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this)).onChangeValue=function(e){var t=[],a=[];Array.from(e.target.selectedOptions,(function(e){e.value&&e.value.length>0&&(t.push(e.value),a.push(e.text))})),n.setState({value:t,description:a},n.onChange)},n.state={value:[],description:[]},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.context.value;this.setState({value:e&&e.value?e.value:[]})}},{key:"onChange",value:function(){var e=Object(P.a)({},this.state);this.context.onChange(e,this.context.filterItem)}},{key:"render",value:function(){var e=this.context.filterItem,t="Y"===e.Multiple&&this.state.value.length>0||"Y"!==e.Multiple&&this.state.value.length>0;return Object(S.jsxs)("div",{className:"md-form md-outline m-0",children:[Object(S.jsx)("label",{className:t?"active":"","data-l10n-id":e.Title}),Object(S.jsx)("select",{className:"browser-default custom-select",value:"Y"===e.Multiple?this.state.value:this.state.value.length<1?"":this.state.value[0],onChange:this.onChangeValue,multiple:"Y"===e.Multiple,children:e.Items.map((function(e){return Object(S.jsx)("option",{value:e.id,"data-l10n-id":e.name},e.id)}))})]})}}]),a}(i.a.Component);de.contextType=q;var he=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this)).onChangeValue=function(e){var t=[],a=[];e&&(t.push(e.value),a.push(e.label)),n.setState({value:t,description:a},n.onChange)},n.state={value:[],description:[],loaded:!1},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.context.value;this.setState({value:e&&e.value?e.value:[],description:e&&e.description?e.description:[],loaded:!0})}},{key:"onChange",value:function(){var e=Object(P.a)({},this.state);this.context.onChange(e,this.context.filterItem)}},{key:"render",value:function(){var e=this.context.filterItem,t=this.state.value.length>0&&{value:this.state.value[0],label:this.state.description.length>0?this.state.description[0]:""};return Object(S.jsx)("div",{className:"form-outline m-0",children:this.state.loaded&&Object(S.jsx)(ae,{title:e.Title,value:t,onChange:this.onChangeValue})})}}]),a}(i.a.Component);he.contextType=q;var fe=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this)).onChangeValue=function(e){var t=[],a=[];e&&(t.push(e.value),a.push(e.label)),n.setState({value:t,description:a},n.onChange)},n.state={value:[],description:[],loaded:!1},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.context.value;this.setState({value:e&&e.value?e.value:[],description:e&&e.description?e.description:[],loaded:!0})}},{key:"onChange",value:function(){var e=Object(P.a)({},this.state);this.context.onChange(e,this.context.filterItem)}},{key:"render",value:function(){var e=this.context.filterItem,t=this.state.value.length>0&&{value:this.state.value[0],label:this.state.description.length>0?this.state.description[0]:""};return Object(S.jsx)("div",{className:"form-outline m-0",children:this.state.loaded&&Object(S.jsx)(ie,{title:e.Title,value:t,onChange:this.onChangeValue})})}}]),a}(i.a.Component);fe.contextType=q;var me=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this)).onChangeValue=function(e){var t=[],a=[];e&&(t.push(e.value),a.push(e.label)),n.setState({value:t,description:a},n.onChange)},n.state={value:[],description:[],loaded:!1},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.context.value;this.setState({value:e&&e.value?e.value:[],description:e&&e.description?e.description:[],loaded:!0})}},{key:"onChange",value:function(){var e=Object(P.a)({},this.state);this.context.onChange(e,this.context.filterItem)}},{key:"render",value:function(){var e=this.context.filterItem,t=this.state.value.length>0&&{value:this.state.value[0],label:this.state.description.length>0?this.state.description[0]:""};return Object(S.jsx)("div",{className:"form-outline m-0",children:this.state.loaded&&Object(S.jsx)(se,{title:e.Title,value:t,onChange:this.onChangeValue})})}}]),a}(i.a.Component);me.contextType=q;var pe=ce,ve=function(){function e(){Object(u.a)(this,e),this.Filters=[],this.Table=""}return Object(d.a)(e,[{key:"get",value:function(e,t){var a=this;switch(e){case"filter-devices":return a.Table=e,void a.devices(t);case"filter-programs":return a.Table=e,void a.programs(t)}t()}},{key:"programs",value:function(e){var t=this;document.l10n.formatValue("filter-default-programs-active").then((function(a){t.Filters.push({name:a,fields:[{value:{value:"0",type:Y,description:["> 0"]},title:"field-used-on-devices",name:"usage"}]}),t.tryAddFilter(e)}))}},{key:"devices",value:function(e){var t=this;document.l10n.formatValue("filter-default-devices-in-progress").then((function(a){t.Filters.push({name:a,fields:[{value:!1,title:"field-growth-program",name:"programId"}]}),document.l10n.formatValue("field-harvesting").then((function(a){document.l10n.formatValue("date-today").then((function(n){t.Filters.push({name:a,fields:[{value:{period:J,type:K,description:[n]},title:"field-harvesting",name:"harvestDate"}]}),t.tryAddFilter(e)}))}))}))}},{key:"tryAddFilter",value:function(e){var t=this;t.Filters.length<1?e():t.addFilter(t.Filters[0].name,t.Filters[0].fields,(function(){t.Filters.splice(0,1),t.tryAddFilter(e)}))}},{key:"addFilter",value:function(e,t,a){this.Table,JSON.stringify(t);a()}}]),e}(),be=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,null,[{key:"saveToLocalStorage",value:function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(a){console.warn(a)}}},{key:"getFromLocalStorage",value:function(e){try{var t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(a){return console.warn(a),null}}},{key:"getStringArray",value:function(e){var t=[];if(!e)return t;var a=e.toString().split(";");for(var n in a)t.push(a[n]);return t}},{key:"tryParseJson",value:function(e){if(!e||e.length<1)return!1;var t={};try{t=JSON.parse(e)}catch(a){console.warn(e),console.warn(a),t=!1}return t}},{key:"getArrayTimeFromSeconds",value:function(e){var t=Math.round(e/3600);return[t,Math.round((e-3600*t)/60),e%60]}},{key:"secondsToString",value:function(e){var t=Math.floor(e/60/60),a=Math.floor(e/60)-60*t,n=e%60;return t<1?[a.toString().padStart(2,"0"),n.toString().padStart(2,"0")].join(":"):[t.toString().padStart(2,"0"),a.toString().padStart(2,"0"),n.toString().padStart(2,"0")].join(":")}},{key:"getError",value:function(e){return e.response?e.response.data:e}},{key:"searchPrefix",value:function(e){return"<".concat(e,">")}}]),e}();be.convertFileBase64=function(e){return new Promise((function(t,a){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){var e;n.result&&"string"===typeof n.result&&t(null===(e=n.result)||void 0===e?void 0:e.split(",")[1])},n.onerror=function(e){a(e)}}))};var je,ge=be;!function(e){e.settings="settings",e.log="log",e.filter="filter",e.filterSort="filtersort"}(je||(je={}));var Oe=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(u.a)(this,a),(n=t.call(this,e)).getFilterItemByName=function(e){var t=n.props.items.findIndex((function(t){return t.Name===e}));return!(t<0)&&n.props.items[t]},n.saveSortingRequest=function(){var e=Object(h.a)(n),t={ENTITY:je.filterSort,FILTER:{PROPERTY_TABLE:e.props.id,PROPERTY_USER:e.context.getCurrentUser().Id}};F.callMethod("entity.item.get",t,!0).then((function(t){t.items.length<1?F.callMethod("entity.item.add",{ENTITY:je.filterSort,NAME:je.filterSort,PROPERTY_VALUES:{TABLE:e.props.id,DATA:JSON.stringify(n.state.filterSorting),USER:e.context.getCurrentUser().Id}}).catch((function(e){console.error("saveSortingRequest add",e)})):F.callMethod("entity.item.update",{ENTITY:je.filterSort,ID:t.items[0].ID,PROPERTY_VALUES:{DATA:JSON.stringify(n.state.filterSorting)}}).catch((function(e){console.error("saveSortingRequest update",e)}))})).catch((function(e){console.error("saveSortingRequest",e)}))},n.clickFind=function(e){e&&e.preventDefault(),n.closeModal(),n.find()},n.clickReset=function(){n.setState({currentFilterId:""}),n.removeRequestParams(),n.closeModal(),n.find()},n.clickClear=function(e){e&&e.preventDefault(),n.setState({currentFilterId:""}),n.removeRequestParams(!0),n.find()},n.removeRequestParams=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.setState({requestParams:n.state.requestParams.map((function(t){return(t.title||e)&&(t.value=!1),t}))})},n.clickCreateFilterMode=function(){n.setState({editMode:!0,currentFilterId:"new"})},n.clickEditMode=function(){var e=n.state.loadedFilters[n.state.currentFilterId];e?n.setState({editFilterName:e.name,editMode:!0}):n.setState({currentFilterId:"",editMode:!0})},n.clickRemoveUserFilters=function(){var e=Object(h.a)(n);e.removeLoadedFilters((function(){(new ve).get(e.props.id,(function(){e.loadFilters((function(){e.clickCancel()}),!0)}))}))},n.openModal=function(){var e=Object(h.a)(n);n.setState({showModal:!0},(function(){e.inputText.current.focus()}))},n.toggleModal=function(){n.setState({showModal:!n.state.showModal})},n.closeModal=function(){n.setState({showModal:!1})},n.openModalFields=function(e){console.log("openModalFields",e),n.setState({showFieldsVisibility:!0})},n.loadFilterDefaultFields=function(e){e&&e.preventDefault();var t=Object(h.a)(n),a=n.state.requestParams;t.props.items.forEach((function(e){var t=a.findIndex((function(t){return t.name===e.Name}));t<0&&(e.Typing||e.Default)&&a.push({name:e.Name,value:!1}),t>-1&&!e.Typing&&!e.Default&&a.splice(t,1)})),t.setState({requestParams:a})},n.saveFilterRequest=function(e,t){var a=Object(h.a)(n),i={ENTITY:je.filter,NAME:t,PROPERTY_VALUES:{TABLE:a.props.id,DATA:JSON.stringify(a.state.requestParams),DEFAULT:"N",USER:a.context.getCurrentUser().Id}};e?(i.ID=e,F.callMethod("entity.item.update",i).then((function(t){a.loadFilters((function(){a.setState({editMode:!1}),a.clickSelectFilter(!1,e)}))})).catch((function(e){console.error("saveFilterRequest",e)}))):F.callMethod("entity.item.add",i).then((function(e){a.loadFilters((function(){a.setState({editMode:!1}),a.clickSelectFilter(!1,e.items[0])}))})).catch((function(e){console.error("saveFilterRequest",e)}))},n.clickSave=function(){var e=n.state.editFilterName.trim();if(!(e.length<1))if("new"===n.state.currentFilterId)n.saveFilterRequest(!1,e);else{var t=parseInt(n.state.currentFilterId)||0;t>0?n.saveFilterRequest(t,e):n.setState({editMode:!1})}},n.clickCancel=function(){n.setState({editMode:!1})},n.clickSaveFieldsVisibility=function(e){if(e){var t=n.state.requestParams.filter((function(t){return e.includes(t.name)||n.TypingFilterItem&&n.TypingFilterItem.Name===t.name}));return e.forEach((function(e){t.findIndex((function(t){return t.name===e}))<0&&t.push({value:!1,name:e})})),void n.setState({requestParams:t,showFieldsVisibility:!1})}n.setState({showFieldsVisibility:!1})},n.clickRemovePresetFilter=function(e){var t=n.state.requestParams;t.forEach((function(e){e.value=!1})),n.setState({currentFilterId:"",requestParams:t},n.find())},n.clickRemovePresetParam=function(e,t){var a=n.state.requestParams,i=a.findIndex((function(e){return e.name===t.name}));i>-1&&(a[i].value=!1,n.setState({requestParams:a},n.find()))},n.clickRemovePresetMore=function(e,t){n.setState({requestParams:n.state.requestParams.filter((function(e){return!t.find((function(t){return t.name===e.name}))}))})},n.clickRemoveField=function(e){n.setState({requestParams:n.state.requestParams.filter((function(t){return t.name!==e}))})},n.changeValue=function(e,t){var a=n.state.requestParams,i=a.findIndex((function(e){return e.name===t.Name}));i>-1&&(a[i].title=t.Title,a[i].value=e,n.setState({requestParams:a}))},n.changeTextInput=function(e){var t=Object(h.a)(n);if(t.TypingFilterItem){var a=t.state.requestParams.slice(),i=a.findIndex((function(e){return e.name===t.TypingFilterItem.Name}));i<0&&e.target.value.length>0?a.push({value:e.target.value,name:t.TypingFilterItem.Name}):e.target.value.length>0?a[i]={value:e.target.value,name:t.TypingFilterItem.Name}:a.splice(i,1),t.setState({requestParams:a,showModal:!1},t.find)}},n.changeEditFilterName=function(e){e&&e.preventDefault(),n.setState({editFilterName:e.target.value})},n.clickSelectFilter=function(e,t){e&&e.preventDefault(),console.log("clickSelectFilter",t),n.setState({currentFilterId:t,editFilter:!1,editFilterName:n.state.loadedFilters[t].name,requestParams:n.state.loadedFilters[t].data.map((function(e){return Object(P.a)({},e)}))})},n.clickEditFilterName=function(e,t){e&&e.preventDefault();var a=Object(h.a)(n);a.setState({editFilter:!0,editFilterName:a.state.loadedFilters[t].name})},n.clickRemoveFilter=function(e,t){e&&e.preventDefault();var a=Object(h.a)(n);a.removeFilterRequest([t]).then((function(){a.loadFilters((function(){}))}))},n.onSortFields=function(e,t){e.oldIndex!==e.newIndex&&n.setState({requestParams:M()(n.state.requestParams,e.oldIndex,e.newIndex)})},n.onSortFilters=function(e,t){e.oldIndex!==e.newIndex&&n.setState({filterSorting:M()(n.state.filterSorting,e.oldIndex,e.newIndex)},n.saveSortingRequest)},n.state={showModal:!1,loadedFilters:{},requestParams:[],editMode:!1,showFieldsVisibility:!1,currentFilterId:"",editFilter:!1,editFilterName:"",filterSorting:!1},n.findTimestamp=0,n.findDelay=700,n.filterContainer=i.a.createRef(),n.inputText=i.a.createRef();var r=e.items.findIndex((function(e){return"Y"===e.Typing}));return r>-1&&(n.TypingFilterItem=e.items[r]),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this;e.loadFilters((function(){e.loadStateParams()}))}},{key:"loadFilters",value:function(e,t){var a=this;a.loadFiltersRequest((function(n,i){n.length<1&&!t?(new ve).get(a.props.id,(function(){a.loadFilters(e,!0)})):a.loadFiltersEndAction(n,i,e)}),(function(){a.loadFiltersEndAction([],[],e)}))}},{key:"loadFiltersRequest",value:function(e,t){var a=this,n=[],i={ENTITY:je.filter,FILTER:{PROPERTY_TABLE:a.props.id,PROPERTY_USER:a.context.getCurrentUser().Id}};F.callMethod("entity.item.get",i,!0).then((function(t){n=t.items.map((function(e){return new Ae(e)})),a.loadFiltersSorting((function(t){e(n,t)}))})).catch((function(e){var a=e.ex?e.ex:e;console.error("error-get-filters",a),t()}))}},{key:"loadFiltersSorting",value:function(e){var t=[],a={ENTITY:je.filterSort,FILTER:{PROPERTY_TABLE:this.props.id,PROPERTY_USER:this.context.getCurrentUser().Id}};F.callMethod("entity.item.get",a,!0).then((function(a){a.items.length<1?e(t):e(ge.tryParseJson(a.items[0].PROPERTY_VALUES.DATA)||[])})).catch((function(a){var n=a.ex?a.ex:a;console.error("error-get-filters-sort",n),e(t)}))}},{key:"loadFiltersEndAction",value:function(e,t,a){var n=[],i=[];t.forEach((function(t){var a=e.find((function(e){return e.id===t}));a&&(n.push(a.id),i.push(a))})),e.filter((function(e){return!n.includes(e.id)})).forEach((function(e){i.push(e),n.push(e.id)}));var r={};i.forEach((function(e){r[e.id]=e})),this.setState({loadedFilters:r,filterSorting:n},a)}},{key:"loadStateParams",value:function(){var e=this;if(e.props.query){var t=[];if(Object.keys(e.props.query).forEach((function(a){var n=e.getFilterItemByName(a);n&&t.push({name:a,title:n.Title,value:{value:[e.props.query[a]],description:[e.props.query[a]]}})})),t.length>0)return void e.setState({currentFilterId:"",requestParams:t},e.find)}var a=e.getFromLocalStorage("".concat(e.props.id));if(a){var n=ge.tryParseJson(a);e.setState({currentFilterId:n.currentFilterId?n.currentFilterId:"",requestParams:Array.isArray(n.requestParams)?n.requestParams.slice():[]},e.find)}else e.find()}},{key:"removeLoadedFilters",value:function(e){var t=this,a=Object.keys(t.state.loadedFilters);if(a.length<1)e();else{var n=a.filter((function(e){return t.state.loadedFilters[e].default}));n.length<1?e():t.removeFilterRequest(n).then((function(){e()}))}}},{key:"find",value:function(e){var t=this,a=(new Date).getTime();t.findTimestamp=a,setTimeout((function(){t.findTimestamp===a&&t.findAction()}),t.findDelay)}},{key:"findAction",value:function(){this.trySaveStateParams(),this.props.refreshTable()}},{key:"trySaveStateParams",value:function(){try{this.saveInLocalStorage("".concat(this.props.id),JSON.stringify({currentFilterId:this.state.currentFilterId,requestParams:this.state.requestParams}))}catch(e){console.error("save filter params",e)}}},{key:"getModalStyle",value:function(){return{overlay:{backgroundColor:"transparent"},content:{top:this.filterContainer.current.offsetTop+40,left:this.filterContainer.current.offsetLeft,right:"auto",bottom:"auto",width:this.filterContainer.current.offsetWidth,padding:0}}}},{key:"saveInLocalStorage",value:function(e,t){try{localStorage.setItem(e,t)}catch(a){console.warn(a)}}},{key:"getFromLocalStorage",value:function(e){try{return localStorage.getItem(e)}catch(t){console.warn(t)}return!1}},{key:"removeFilterRequest",value:function(){var e=Object(o.a)(l.a.mark((function e(t){var a,n,i,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this,n=Object(I.a)(t),e.prev=2,n.s();case 4:if((i=n.n()).done){e.next=16;break}return r=i.value,e.prev=6,e.next=9,F.callMethod("entity.item.delete",{ENTITY:je.filter,ID:r});case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),console.error("removeFilterRequest",e.t0);case 14:e.next=4;break;case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(2),n.e(e.t1);case 21:return e.prev=21,n.f(),e.finish(21);case 24:t.includes(a.state.currentFilterId)&&a.setState({currentFilterId:""}),a.setState({filterSorting:a.state.filterSorting.filter((function(e){return!t.includes(e)}))});case 26:case"end":return e.stop()}}),e,this,[[2,18,21,24],[6,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"fillRequestFilter",value:function(e){var t=this;return t.props.items.forEach((function(a){var n=a.Name;switch(a.Type){case U.Hidden:var i=ge.getStringArray(t.getValueByName(a.Name));i&&i.length>0&&("Y"==a.PREFIX?t.addValueToRequestFilter(e,"%".concat(n),i[0]):t.addValueToRequestFilter(e,n,i));break;case U.Text:var r=t.getValueByName(a.Name);r&&r.value.length>0&&t.addValueToRequestFilter(e,n,r.value[0]);break;case U.NumberRange:var s=t.getValueByName(a.Name);if(s&&(s.from&&t.addValueToRequestFilter(e,">=".concat(n),s.from),s.to&&t.addValueToRequestFilter(e,"<=".concat(n),s.to),s.value))switch(s.type){case Y:t.addValueToRequestFilter(e,">".concat(n),s.value);break;case B:t.addValueToRequestFilter(e,"<".concat(n),s.value);break;default:t.addValueToRequestFilter(e,"".concat(n),s.value)}break;case U.DateRange:var c=t.getValueByName(a.Name);if(c){if(c.from&&t.addValueToRequestFilter(e,">=".concat(n),a.NUMBER?new Date(c.from).getTime():new Date(c.from).toISOString()),c.to&&t.addValueToRequestFilter(e,"<=".concat(n),a.NUMBER?new Date(c.to).getTime():new Date(c.to).toISOString()),c.value)switch(c.type){case Y:t.addValueToRequestFilter(e,">=".concat(n),a.NUMBER?new Date(c.value).getTime():new Date(c.value).toISOString());break;case B:t.addValueToRequestFilter(e,"<=".concat(n),a.NUMBER?new Date(c.value).getTime():new Date(c.value).toISOString());break;default:t.addValueToRequestFilter(e,"".concat(n),a.NUMBER?new Date(c.value).getTime():new Date(c.value).toISOString())}if(c.period)switch(c.period){case J:t.addValueToRequestFilter(e,">=".concat(n),a.NUMBER?O()().startOf("day").valueOf():O()().format(O.a.HTML5_FMT.DATE)),t.addValueToRequestFilter(e,"<=".concat(n),a.NUMBER?O()().startOf("day").add(1,"day").valueOf():O()().add(1,"day").format(O.a.HTML5_FMT.DATE));break;case G:t.addValueToRequestFilter(e,">=".concat(n),a.NUMBER?O()().startOf("day").subtract(1,"day").valueOf():O()().subtract(1,"day").format(O.a.HTML5_FMT.DATE)),t.addValueToRequestFilter(e,"<=".concat(n),a.NUMBER?O()().startOf("day").valueOf():O()().format(O.a.HTML5_FMT.DATE));break;case X:t.addValueToRequestFilter(e,">=".concat(n),a.NUMBER?O()().subtract(7,"day").valueOf():O()().subtract(7,"day").format(O.a.HTML5_FMT.DATE)),t.addValueToRequestFilter(e,"<=".concat(n),a.NUMBER?O()().add(1,"day").valueOf():O()().add(1,"day").format(O.a.HTML5_FMT.DATE));break;case z:t.addValueToRequestFilter(e,">=".concat(n),a.NUMBER?O()().subtract(30,"day").valueOf():O()().subtract(30,"day").format(O.a.HTML5_FMT.DATE)),t.addValueToRequestFilter(e,"<=".concat(n),a.NUMBER?O()().add(1,"day").valueOf():O()().add(1,"day").format(O.a.HTML5_FMT.DATE))}}break;case U.Select:case U.DealSelect:case U.ContactSelect:case U.UserSelect:var l=t.getValueByName(a.Name);l&&l.value&&l.value.length>0&&t.addValueToRequestFilter(e,"".concat(n),l.value)}})),e}},{key:"getValueByName",value:function(e){var t=this.state.requestParams.findIndex((function(t){return t.name===e}));return!(t<0)&&this.state.requestParams[t].value}},{key:"addValueToRequestFilter",value:function(e,t,a){(a||0===a)&&(e[t]=a)}},{key:"compareFilterFields",value:function(){if(!this.state.currentFilterId||!this.state.loadedFilters[this.state.currentFilterId])return!1;var e=this.state.requestParams,t=this.state.loadedFilters[this.state.currentFilterId].data,a=!0;return e.forEach((function(e){var n=t.findIndex((function(t){return t.name===e.name}));return n<0&&e.value||t[n]&&JSON.stringify(e.value)!==JSON.stringify(t[n].value)?(a=!1,!1):void 0})),a}},{key:"render",value:function(){var e=this,t=!!(e.state.currentFilterId&&e.state.loadedFilters[e.state.currentFilterId]&&e.compareFilterFields())&&e.state.loadedFilters[e.state.currentFilterId],a=!1,n=!1,r=[],s="";e.state.requestParams.slice().reverse().forEach((function(e){if(e.value||!1===e.value)return e.title||!1===e.value?void(e.value.description&&Array.isArray(e.value.description)&&e.value.description.length<1||r.push(e)):(a=!0,void(s=e.value))}));var c=[];if(t)c.push(Object(S.jsxs)("div",{className:"filter-preset-item",title:t.name,children:[Object(S.jsx)("span",{className:"filter-preset-item-text",children:t.name}),Object(S.jsx)("span",{className:"preset-remove",onClick:this.clickRemovePresetFilter,children:Object(S.jsx)("i",{className:"fas fa-times"})})]},t.id)),n=!0;else{var l=[];r.filter((function(e){return!(!1===e.value||e.value.length<1)})).forEach((function(t){c.length>2?l.push(t):(c.push(Object(S.jsxs)("div",{className:"filter-preset-item",children:[t.value.description&&Array.isArray(t.value.description)&&Object(S.jsxs)("span",{className:"filter-preset-item-text",title:t.value.description.join(", "),children:[Object(S.jsx)("span",{children:Object(S.jsx)(A.a,{children:t.title})}),": ",Object(S.jsx)("span",{children:t.value.description.join(", ")})]}),Object(S.jsx)("span",{className:"preset-remove",onClick:function(a){return e.clickRemovePresetParam(a,t)},children:Object(S.jsx)("i",{className:"fas fa-times"})})]},t.name)),n=!0)})),l.length>0&&c.push(Object(S.jsxs)("div",{className:"filter-preset-item",children:[Object(S.jsxs)("span",{className:"filter-preset-item-text",children:[Object(S.jsx)(A.a,{children:"filter-preset-more"})," ",l.length]}),Object(S.jsx)("span",{className:"preset-remove",onClick:function(t){return e.clickRemovePresetMore(t,l)},children:Object(S.jsx)("i",{className:"fas fa-times"})})]},"more"))}return Object(S.jsxs)("div",{className:"filter-search",ref:this.filterContainer,children:[c.map((function(e){return e})),Object(S.jsx)("input",{type:"text",ref:this.inputText,name:"find",value:s,className:"filter-search-text",autoComplete:"off",onChange:this.changeTextInput,onClick:this.toggleModal,placeholder:w.a.t(n?"filter-find-not-empty":"filter-find-empty")}),Object(S.jsxs)("div",{className:"main-ui-item-icon-block",children:[Object(S.jsx)("span",{className:"main-ui-item-icon",onClick:this.clickFind,children:Object(S.jsx)("i",{className:"fas fa-search"})}),(a||n)&&Object(S.jsx)("span",{className:"main-ui-item-icon",onClick:this.clickClear,children:Object(S.jsx)("i",{className:"fas fa-times"})})]}),this.state.showModal&&Object(S.jsx)("div",{className:"filter-modal",children:Object(S.jsxs)("div",{className:"row",children:[Object(S.jsxs)("div",{className:"col-12 col-xl-3 d-fl ex flex-col umn",children:[Object(S.jsx)("div",{className:"main-ui-filter-sidebar-title",children:Object(S.jsx)("h5",{className:"main-ui-filter-sidebar-title-item",children:Object(S.jsx)(A.a,{children:"filter-title-filters"})})}),Object(S.jsxs)("div",{className:"".concat(this.state.filterSorting&&this.state.filterSorting.length>0?"flex-grow-1":""," main-ui-filter-sidebar-item-container"),children:[Object(S.jsx)(Ie,{helperClass:"sortable-helper",lockAxis:"y",useDragHandle:!0,pressDelay:200,editMode:this.state.editMode,editFilter:this.state.editFilter,editFilterName:this.state.editFilterName,items:this.state.filterSorting,loadedFilters:this.state.loadedFilters,currentFilterId:this.state.currentFilterId,currentFilter:t,onSortEnd:this.onSortFilters,changeEditFilterName:this.changeEditFilterName,clickSelectFilter:this.clickSelectFilter,clickEditFilterName:this.clickEditFilterName,clickRemoveFilter:this.clickRemoveFilter}),this.state.editMode&&"new"===e.state.currentFilterId&&Object(S.jsx)("div",{className:"main-ui-filter-sidebar-item main-ui-filter-ne w-filter",children:Object(S.jsx)("div",{className:"main-ui-filter-edit-mask",children:Object(S.jsx)("input",{type:"text",className:"main-ui-filter-sidebar-edit-control",placeholder:w.a.t("filter-name"),value:this.state.editFilterName,onChange:this.changeEditFilterName})})})]}),Object(S.jsxs)("div",{className:"d-flex px-2 mt-2",children:[!this.state.editMode&&Object(S.jsxs)("span",{className:"main-ui-filter-add-item flex-grow-1",onClick:this.clickCreateFilterMode,children:[Object(S.jsx)("i",{className:"fas fa-plus me-1"}),Object(S.jsx)("span",{children:Object(S.jsx)(A.a,{children:"filter-btn-save-filter"})})]}),!this.state.editMode&&Object(S.jsx)("span",{className:"main-ui-filter-add-edit",title:w.a.t("filter-btn-edit-filter"),onClick:this.clickEditMode,children:Object(S.jsx)("i",{className:"fas fa-cog mt-1"})}),this.state.editMode&&Object(S.jsxs)("span",{className:"main-ui-filter-reset-link mb-2",onClick:this.clickRemoveUserFilters,children:[Object(S.jsx)("i",{className:"fas fa-reply me-1"}),Object(S.jsx)("span",{children:Object(S.jsx)(A.a,{children:"filter-btn-reset-filter"})})]})]}),Object(S.jsx)("div",{className:"d-block d-xl-none",children:Object(S.jsx)("hr",{className:"my-2"})})]}),Object(S.jsxs)("div",{className:"col-12 col-xl-9",children:[!this.state.showFieldsVisibility&&Object(S.jsxs)(i.a.Fragment,{children:[Object(S.jsxs)("div",{className:"d-flex flex-column flex-gro w-1",children:[Object(S.jsx)(Te,{helperClass:"sortable-helper",lockAxis:"y",useDragHandle:!0,pressDelay:200,currentFilterId:this.state.currentFilterId,items:this.state.requestParams,getFilterItemByName:this.getFilterItemByName,onSortEnd:this.onSortFields,onChangeValue:this.changeValue,onClickRemove:this.clickRemoveField}),Object(S.jsxs)("div",{className:"d-flex justify-content-center mt-2 mb-3",children:[Object(S.jsx)("span",{className:"main-ui-filter-field-add-item",onClick:this.openModalFields,children:Object(S.jsx)(A.a,{children:"filter-btn-add-field"})}),Object(S.jsx)("span",{className:"main-ui-filter-field-restore-items",onClick:this.loadFilterDefaultFields,children:Object(S.jsx)(A.a,{children:"filter-btn-restore-fields"})})]})]}),Object(S.jsx)("div",{className:"",children:Object(S.jsxs)("div",{className:"d-flex justify-content-center",children:[!this.state.editMode&&Object(S.jsxs)("div",{className:"mb-2",children:[Object(S.jsxs)("button",{className:"btn btn-primary btn-md me-2",onClick:this.clickFind,children:[Object(S.jsx)("i",{className:"fas fa-search me-2"}),Object(S.jsx)("span",{children:Object(S.jsx)(A.a,{children:"filter-btn-search"})})]}),Object(S.jsx)("button",{className:"btn btn-outline-primary btn-md",onClick:this.clickReset,children:Object(S.jsx)(A.a,{children:"filter-btn-reset"})})]}),this.state.editMode&&Object(S.jsxs)("div",{className:"mb-2",children:[Object(S.jsx)("button",{className:"btn btn-success btn-md me-2",onClick:this.clickSave,children:Object(S.jsx)(A.a,{children:"filter-btn-save"})}),Object(S.jsx)("button",{className:"btn btn-outline-success btn-md",onClick:this.clickCancel,children:Object(S.jsx)(A.a,{children:"filter-btn-cancel"})})]})]})})]}),this.state.showFieldsVisibility&&Object(S.jsx)(Pe,{items:this.props.items,requestParams:this.state.requestParams,save:this.clickSaveFieldsVisibility})]})]})})]})}}]),a}(i.a.Component);Oe.contextType=x;var ye,xe=Object(R.c)((function(){return Object(S.jsx)("div",{className:"main-ui-item-icon main-ui-filter-icon-grab",title:w.a.t("filter-sort-filter"),children:Object(S.jsx)("i",{className:"fas fa-bars"})})})),Ne=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){var e=this;return Object(S.jsxs)("div",{className:"d-flex mb-3",children:[Object(S.jsx)(xe,{}),Object(S.jsx)("div",{className:"flex-grow-1",children:Object(S.jsx)(q.Provider,{value:{value:this.props.item.value,filterItem:this.props.filterItem,onChange:this.props.onChangeValue,language:F.getLang()},children:Object(S.jsx)(pe,{})})}),Object(S.jsx)("div",{className:"main-ui-item-icon pe-2 me-1",onClick:function(){return e.props.onClickRemove(e.props.item.name)},children:Object(S.jsx)("i",{className:"fas fa-times"})})]})}}]),a}(i.a.Component),Se=Object(R.b)(Ne),ke=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){var e=this;return Object(S.jsx)("div",{className:"mt-3",children:this.props.items.map((function(t,a){var n=e.props.getFilterItemByName(t.name);if(n&&n.Type!==U.Hidden)return Object(S.jsx)(Se,{index:a,item:t,filterItem:n,onChangeValue:e.props.onChangeValue,onClickRemove:e.props.onClickRemove},"".concat(t.name,"_").concat(e.props.currentFilterId))}))})}}]),a}(i.a.Component),Te=Object(R.a)(ke),Ee=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){var e=this;return Object(S.jsxs)("div",{className:"d-flex main-ui-filter-sidebar-item ".concat(this.props.currentFilter&&this.props.currentFilterId==this.props.id?"main-ui-filter-current-item":""),children:[Object(S.jsx)(xe,{}),this.props.editFilter&&this.props.currentFilterId==this.props.id?Object(S.jsx)("div",{className:"flex-grow-1 p-2 main-ui-filter-sidebar-item-text-container",children:Object(S.jsx)("input",{type:"text",className:"main-ui-filter-sidebar-item-input",placeholder:w.a.t("filter-name"),autoFocus:!0,value:this.props.editFilterName,onChange:this.props.changeEditFilterName})}):Object(S.jsx)("div",{className:"flex-grow-1 p-2 main-ui-filter-sidebar-item-text-container",onClick:function(t){return e.props.clickSelectFilter(t,e.props.id)},children:Object(S.jsx)("span",{className:"main-ui-filter-sidebar-item-text",children:this.props.filter.name})}),this.props.editMode&&Object(S.jsxs)(i.a.Fragment,{children:[Object(S.jsx)("div",{className:"main-ui-item-icon main-ui-filter-icon-edit",title:w.a.t("filter-edit-filter-name"),onClick:function(t){return e.props.clickEditFilterName(t,e.props.id)},children:Object(S.jsx)("i",{className:"fas fa-pen"})}),Object(S.jsx)("div",{className:"main-ui-item-icon main-ui-delete main-ui-filter-filter-delete",title:w.a.t("filter-delete-filter"),onClick:function(t){return e.props.clickRemoveFilter(t,e.props.id)},children:Object(S.jsx)("i",{className:"fas fa-times"})})]})]})}}]),a}(i.a.Component),Fe=Object(R.b)(Ee),Ce=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){var e=this;return Object(S.jsx)("div",{children:this.props.items&&this.props.items.map((function(t,a){return Object(S.jsx)(Fe,{index:a,id:t,currentFilter:e.props.currentFilter,currentFilterId:e.props.currentFilterId,editMode:e.props.editMode,editFilter:e.props.editFilter,editFilterName:e.props.editFilterName,changeEditFilterName:e.props.changeEditFilterName,clickSelectFilter:e.props.clickSelectFilter,filter:e.props.loadedFilters[t],clickEditFilterName:e.props.clickEditFilterName,clickRemoveFilter:e.props.clickRemoveFilter},t)}))})}}]),a}(i.a.Component),Ie=Object(R.a)(Ce),Pe=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(u.a)(this,a),(n=t.call(this)).clickSaveFields=function(){n.props.save(n.state.selected)},n.clickCancelFields=function(){n.props.save(!1)},n.select=function(e){var t=n.state.selected,a=t.indexOf(e);a<0?t.push(e):t.splice(a,1),n.setState({selected:t})};var i=[];return e.requestParams&&Array.isArray(e.requestParams)&&e.requestParams.forEach((function(e){e.name&&i.push(e.name)})),n.state={selected:i},n}return Object(d.a)(a,[{key:"render",value:function(){var e=this;return Object(S.jsxs)(i.a.Fragment,{children:[Object(S.jsx)("div",{className:"d-flex flex-column flex-grow-1",children:Object(S.jsx)("div",{className:"row px-3",children:this.props.items.map((function(t){if(t.Type!==U.Hidden)return Object(S.jsx)("div",{className:"col-6 main-ui-select-inner-item main-ui-filter-field-list-item ".concat(e.state.selected.includes(t.Name)?"main-ui-checked":""),onClick:function(){return e.select(t.Name)},children:Object(S.jsx)("div",{className:"main-ui-select-inner-label",children:Object(S.jsx)(A.a,{children:t.Title})})},t.Name)}))})}),Object(S.jsx)("div",{children:Object(S.jsxs)("div",{className:"d-flex justify-content-center mb-2",children:[Object(S.jsx)("button",{className:"btn btn-success btn-md me-2",onClick:this.clickSaveFields,children:Object(S.jsx)(A.a,{children:"filter-btn-save"})}),Object(S.jsx)("button",{className:"btn btn-outline-success btn-md",onClick:this.clickCancelFields,children:Object(S.jsx)(A.a,{children:"filter-btn-cancel"})})]})})]})}}]),a}(i.a.Component),Ae=function e(t){Object(u.a)(this,e),Object.assign(this,t),this.id=parseInt(t.ID)||0,this.table=t.PROPERTY_VALUES.TABLE,this.name=t.NAME,this.user=parseInt(t.PROPERTY_VALUES.USER)||0,this.data=JSON.parse(t.PROPERTY_VALUES.DATA),this.default="Y"===t.PROPERTY_VALUES.DEFAULT},we=Oe,Re=function e(t,a,n,i){if(Object(u.a)(this,e),this.Type=t,this.Name=a,this.Title=n,this.ContainerClassName="",i){var r=Object.keys(i);for(var s in r){var c=r[s];this[c]=i[c]}}},De=new(function(){function e(){Object(u.a)(this,e),this.default="default",this.block="block",this.smallBlock="smallblock"}return Object(d.a)(e,[{key:"getList",value:function(e){var t=[{id:this.default,icon:"fas fa-bars"},{id:this.block,icon:"fas fa-th-large"},{id:this.smallBlock,icon:"fas fa-th"}];return e?t.filter((function(t){return!e.includes(t.id)})):t}}]),e}()),Me=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){return Object(S.jsxs)("div",{className:"flex-center py-3",children:[Object(S.jsx)("div",{className:"spinner-grow text-primary me-1",role:"status",children:Object(S.jsx)("span",{className:"sr-only",children:"Loading..."})}),Object(S.jsx)("div",{className:"spinner-grow text-secondary me-1",role:"status",children:Object(S.jsx)("span",{className:"sr-only",children:"Loading..."})}),Object(S.jsx)("div",{className:"spinner-grow text-success me-1",role:"status",children:Object(S.jsx)("span",{className:"sr-only",children:"Loading..."})}),Object(S.jsx)("div",{className:"spinner-grow text-danger me-1",role:"status",children:Object(S.jsx)("span",{className:"sr-only",children:"Loading..."})}),Object(S.jsx)("div",{className:"spinner-grow text-warning me-1",role:"status",children:Object(S.jsx)("span",{className:"sr-only",children:"Loading..."})}),Object(S.jsx)("div",{className:"spinner-grow text-info",role:"status",children:Object(S.jsx)("span",{className:"sr-only",children:"Loading..."})})]})}}]),a}(i.a.Component),Le=a(93),Ve=a.n(Le),Ue=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){var e;return Object(u.a)(this,a),(e=t.call(this)).selectRow=function(t){if(e.state.selectedItems.includes(t))e.setState({selectedItems:e.state.selectedItems.filter((function(e){return e!==t}))});else{var a=e.state.selectedItems;a.push(t),e.setState({selectedItems:a})}},e.selectAll=function(t){var a=e.state.selectedItems;a.length!==e.state.items.length?(e.state.items.forEach((function(e){a.includes(e.id)||a.push(e.id)})),e.setState({selectedItems:a})):e.setState({selectedItems:[]})},e.getSelectAllCell=function(){var e=this;return Object(S.jsx)("th",{className:"align-middle",children:Object(S.jsx)(L.a,{id:"row-all",checked:this.isSelectedAll(),onChange:function(t){return e.selectAll(t)}})})},e.isSelected=function(t){return e.state.selectedItems.includes(t)},e.isSelectedAll=function(){var t=e.state,a=t.items,n=t.selectedItems;return a.length>0&&a.length===n.length},e.changeOnPage=function(t){if(e.state.onPage!==t){var a=Object(h.a)(e);a.setState({onPage:t,currentPage:1},(function(){a.trySaveTableSettings(),a.tryLoadData()}))}},e.clickPaging=function(t){if("..."!==t&&e.state.currentPage!==t){var a=Object(h.a)(e);a.setState({currentPage:t},(function(){a.tryLoadData()}))}},e.clickSort=function(t,a){var n=Object(h.a)(e);e.state.sortBy!==a?e.setState({sortBy:a,sortOrder:"desc"},(function(){n.trySaveTableSettings(),n.tryLoadData()})):e.setState({sortOrder:"asc"===e.state.sortOrder?"desc":"asc"},(function(){n.trySaveTableSettings(),n.tryLoadData()}))},e.clickEditColumnsVisibility=function(){e.setState({showColumnVisibility:!e.state.showColumnVisibility})},e.clickShowColumn=function(t,a){t.preventDefault();var n=e.state.visibleColumns,i=n.indexOf(a);i>-1?n.splice(i,1):n.push(a);var r=Object(h.a)(e);e.setState({visibleColumns:n},(function(){r.trySaveTableSettings()}))},e.getArrayPagination=function(e,t,a){a=a||3;for(var n=[],i=1;i<=t;i++)(i<=a||i>e-a/2&&i<e+a/2||i>t-a)&&(n[n.length-1]&&i!=n[n.length-1]+1&&n.push("..."),n.push(i));return n},e.clickApplyGroupAction=function(){var t=Object(h.a)(e),a=t.GroupActions.find((function(e){return e.id===t.state.groupAction}));a&&(t.btnGroupAction.setAttribute("disabled","disabled"),a.action((function(){t.btnGroupAction.removeAttribute("disabled")})))},e.getEmptyView=function(){return Object(S.jsxs)("div",{className:"default-block table-empty-block p-2 p-lg-3",children:[Object(S.jsx)("i",{className:"fas fa-exclamation-triangle fa-2x me-2 text-danger"}),Object(S.jsx)("span",{className:"ms-2 ms-lg-3",children:Object(S.jsx)(A.a,{children:e.state.filterKeysLenght>0?e.state.messages.filterEmpty:e.state.messages.empty})})]})},e.getLoadingView=function(){return Object(S.jsx)("div",{className:"default-block table-empty-block p-2 p-lg-3 text-center",children:Object(S.jsx)(Me,{})})},e.Id="table-component",e.state={items:[],total:0,currentPage:1,filter:!1,showOnPage:!0,onPage:10,editColumns:!0,sortBy:"id",sortOrder:"desc",visibleColumns:[],showColumnVisibility:!1,selectedItems:[],groupAction:!1,filterKeysLenght:0,messages:{empty:"data-not-found",filterEmpty:"data-not-found"},firstLoadComplete:!1,loading:!0},e.Header=[],e.GroupActions=[],e.localSaveTimestamp=0,e}return Object(d.a)(a,[{key:"getComponentId",value:function(){return this.Id}},{key:"componentDidMount",value:function(){this.loadTableSettings()}},{key:"loadTableSettings",value:function(){var e=ge.getFromLocalStorage("".concat(this.getComponentId(),"-settings"));e&&this.setState(e)}},{key:"trySaveTableSettings",value:function(){var e=(new Date).getTime(),t=this;t.localSaveTimestamp=e,setTimeout((function(){e===t.localSaveTimestamp&&t.saveTableSettings()}),400)}},{key:"saveTableSettings",value:function(){ge.saveToLocalStorage("".concat(this.getComponentId(),"-settings"),{onPage:this.state.onPage,visibleColumns:this.state.visibleColumns,sortBy:this.state.sortBy,sortOrder:this.state.sortOrder})}},{key:"loadData",value:function(){throw"not override in child"}},{key:"getBlockView",value:function(e){throw"not override in child"}},{key:"getSmallBlockView",value:function(e){throw"not override in child"}},{key:"loadDataError",value:function(e){console.error("loadDataError",e),this.setState({loading:!1})}},{key:"loadDataAlways",value:function(){this.state.firstLoadComplete||this.setState({firstLoadComplete:!0}),F.resizeFrame()}},{key:"tryLoadData",value:function(){var e=this;this.setState({loading:!0},(function(){e.loadData()}))}},{key:"applyFilter",value:function(e){this.state.filter&&(this.state.filter.fillRequestFilter(e),this.setState({filterKeysLenght:Object.keys(e).length})),this.props.filter&&(this.props.filter.current.fillRequestFilter(e),this.setState({filterKeysLenght:Object.keys(e).length}))}},{key:"setFilter",value:function(e){var t=this;t.setState({filter:e},(function(){t.state.filter.FilterContainer.on("filter:find",(function(){t.tryLoadData()}))}))}},{key:"getChunk",value:function(e){if(!e)return[];var t=this,a=t.state.currentPage%(50/t.state.onPage)||50/t.state.onPage;return Ve.a.chunk(e,t.state.onPage)[a-1]||[]}},{key:"printRows",value:function(e,t){e=this.getChunk(e),this.setState({loading:!1,items:e,selectedItems:[],total:t}),this.state.firstLoadComplete||this.setState({firstLoadComplete:!0})}},{key:"getDropdownContent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"shadow-0 px-3",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"fas fa-bars";return Object(S.jsxs)(L.b,{children:[Object(S.jsx)(L.f,{className:t,color:"white",children:Object(S.jsx)("i",{className:a})}),Object(S.jsx)(L.e,{children:e.map((function(e,t){return Object(S.jsx)(L.c,{children:e},t)}))})]})}},{key:"getDropdownCell",value:function(e,t){return Object(S.jsx)("td",{className:"align-middle px-0",children:this.getDropdownContent(e,t)})}},{key:"getSelectRowContent",value:function(e){var t=this;return Object(S.jsx)(L.a,{name:"row-".concat(e),id:"row-".concat(e),checked:this.isSelected(e),onChange:function(){return t.selectRow(e)}})}},{key:"getSelectRowCell",value:function(e){return Object(S.jsx)("td",{className:"align-middle",children:this.getSelectRowContent(e)})}},{key:"getOffset",value:function(){return(this.state.currentPage-1)*this.getStep()}},{key:"getStep",value:function(){return this.state.showOnPage?this.state.onPage:10}},{key:"changeGroupAction",value:function(e){this.setState({groupAction:e.target.value})}},{key:"render",value:function(){var e=this;if(!this.state.firstLoadComplete)return this.getLoadingView();if(this.state.items.length<1)return this.getEmptyView();var t=Math.floor(this.state.total/this.getStep());this.state.total%this.getStep()>0&&(t+=1);var a=this.getArrayPagination(this.state.currentPage,t,3),n=[];return this.GroupActions.length>0&&this.state.selectedItems.length>0&&(n.push({value:"",label:w.a.t("table-select-group-action")}),this.GroupActions.forEach((function(e,t){n.push({value:e.id,label:w.a.t(e.textId)})}))),Object(S.jsxs)(i.a.Fragment,{children:[this.props.style===De.block&&Object(S.jsx)("div",{className:"row",children:this.state.items.map((function(t,a){return Object(S.jsx)(i.a.Fragment,{children:e.getBlockView(t)},a)}))}),this.props.style===De.smallBlock&&Object(S.jsx)("div",{className:"row",children:this.state.items.map((function(t,a){return Object(S.jsx)(i.a.Fragment,{children:e.getSmallBlockView(t)},a)}))}),(this.props.style===De.default||!this.props.style)&&Object(S.jsx)("div",{children:Object(S.jsx)("div",{className:"table-responsive",children:Object(S.jsxs)("table",{className:"table table-hover",children:[Object(S.jsx)("thead",{children:Object(S.jsx)("tr",{children:this.Header.map((function(t,a){if(!t.field||t.alwaysVisible||e.state.visibleColumns.includes(t.field))return t.getHeaderObject?Object(S.jsx)(i.a.Fragment,{children:t.getHeaderObject()},a):Object(S.jsxs)("th",{className:t.sortable?"align-middle sortable":"align-middle",onClick:function(a){return!!t.sortable&&e.clickSort(a,t.field)},children:[t.icon&&Object(S.jsx)("i",{className:t.icon}),t.text_id&&Object(S.jsx)("span",{children:Object(S.jsx)(A.a,{children:t.text_id})}),t.sortable&&e.state.sortBy!==t.field&&Object(S.jsx)("i",{className:"fas fa-angle-down ms-1"}),e.state.sortBy==t.field&&Object(S.jsx)("i",{className:"asc"!==e.state.sortOrder?"fas fa-angle-down ms-1":"fas fa-angle-up ms-1"})]},a)}))})}),Object(S.jsx)("tbody",{children:this.state.items.map((function(t,a){return Object(S.jsx)("tr",{children:e.Header.map((function(a,n){if(!a.field||a.alwaysVisible||e.state.visibleColumns.includes(a.field))return Object(S.jsx)(i.a.Fragment,{children:a.getCellObject(t)},n)}))},t.id)}))})]})})}),this.GroupActions.length>0&&this.state.selectedItems.length>0&&Object(S.jsx)("div",{className:"table-group-actions",children:Object(S.jsx)("div",{className:"row",children:Object(S.jsx)("div",{className:"col-12 col-lg-8 col-xl-5",children:Object(S.jsxs)("div",{className:"d-flex",children:[Object(S.jsx)(V.a,{className:"w-100",defaultValue:this.state.groupAction?this.state.groupAction:n[0],onChange:function(t){return e.changeGroupAction(t)},options:n}),this.state.groupAction.length>0&&Object(S.jsx)("button",{className:"btn btn-success m-0 ms-2 py-1",ref:function(t){return e.btnGroupAction=t},onClick:this.clickApplyGroupAction,children:Object(S.jsx)(A.a,{children:"btn-apply"})})]})})})}),Object(S.jsxs)("div",{className:"row my-3",children:[Object(S.jsx)("div",{className:"col-12 col-lg-6",children:a.length>0&&Object(S.jsx)("div",{className:"table-pagination d-flex",children:a.map((function(t,a){return Object(S.jsx)("button",{disabled:"..."===t,className:t==e.state.currentPage?"active":"",onClick:function(){return e.clickPaging(t)},children:t},a)}))})}),this.state.showOnPage&&Object(S.jsxs)("div",{className:"col-12 col-lg-6 table-on-page d-flex flex-row-reverse",children:[this.state.editColumns&&Object(S.jsxs)(L.b,{children:[Object(S.jsx)(L.f,{className:"shadow-0",color:"light",children:Object(S.jsx)("i",{className:"fas fa-cog"})}),Object(S.jsx)(L.e,{children:this.Header.map((function(t,a){if(!t.alwaysVisible)return t.field?Object(S.jsx)(L.c,{children:Object(S.jsx)(L.d,{tag:"button",type:"button",className:e.state.visibleColumns.includes(t.field)?"active":"",onClick:function(a){return e.clickShowColumn(a,t.field)},children:Object(S.jsx)(A.a,{children:t.text_id})})},a):void 0}))})]}),[50,25,10].map((function(t,a){return Object(S.jsx)("button",{className:t==e.state.onPage?"active":"",onClick:function(){return e.changeOnPage(t)},children:t},a)})),Object(S.jsx)("span",{children:Object(S.jsx)(A.a,{children:"table-on-page"})})]})]})]})}}]),a}(i.a.Component),_e=function(){function e(t){Object(u.a)(this,e),Object.assign(this,t)}return Object(d.a)(e,[{key:"Id",get:function(){return parseInt(this.ID)||0}},{key:"Type",get:function(){return this.PROPERTY_VALUES.TYPE}},{key:"ObjectId",get:function(){return this.PROPERTY_VALUES.OBJECT_ID}},{key:"ObjectType",get:function(){return this.PROPERTY_VALUES.OBJECT_TYPE}},{key:"UserId",get:function(){return parseInt(this.PROPERTY_VALUES.USER)||0}},{key:"Description",get:function(){return this.PROPERTY_VALUES.DESCRIPTION}},{key:"Date",get:function(){return O()(parseInt(this.PROPERTY_VALUES.DATE)||0)}}]),e}();!function(e){e.document="document",e.user="user"}(ye||(ye={}));var qe=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,null,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";switch(e){case ye.document:return"/document/".concat(t);case ye.user:return"/user/".concat(t)}return!1}}]),e}(),Ye=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(u.a)(this,a),(e=t.call(this)).loadData=Object(o.a)(l.a.mark((function t(){var a,n,i,r,s,c,o,u;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object(h.a)(e),n=a.state.sortBy.toUpperCase(),i=a.state.sortOrder.toUpperCase(),(r={ENTITY:je.log,SORT:{},filter:{},start:a.getOffset()}).SORT[n]=i,a.applyFilter(r.filter),t.prev=6,t.next=9,F.callMethod("entity.item.get",r);case 9:return s=t.sent,c=s.items.map((function(e){return new _e(e)})),o=[],c.forEach((function(e){o.includes(e.UserId)||o.push(e.UserId)})),t.next=15,F.getUsers(o);case 15:u=t.sent,c.forEach((function(e){u[e.UserId]&&(e.User=u[e.UserId])})),a.printRows(c,s.total),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(6),a.loadDataError(t.t0);case 23:return t.prev=23,a.loadDataAlways(),t.finish(23);case 26:case"end":return t.stop()}}),t,null,[[6,20,23,26]])}))),e.Id="log-table-component",e.state.sortBy="id",e.state.visibleColumns=["property_type","property_user","property_date"];Object(h.a)(e);return e.Header.push({text_id:"field-id",field:"id",sortable:!0,getCellObject:function(e){return Object(S.jsx)("td",{className:"align-middle",children:e.ID})}}),e.Header.push({text_id:"field-event-type",field:"property_type",getCellObject:function(e){var t=qe.get(e.ObjectType,e.ObjectId);return Object(S.jsx)("td",{className:"align-middle",children:e.Type.indexOf("delete")<0&&t?Object(S.jsx)(p.b,{to:t,children:Object(S.jsxs)(A.a,{children:["log-",e.Type]})}):Object(S.jsx)("span",{children:Object(S.jsxs)(A.a,{children:["log-",e.Type]})})})}}),e.Header.push({text_id:"field-object-id",field:"property_object_id",getCellObject:function(e){return Object(S.jsx)("td",{className:"align-middle",children:e.ObjectId})}}),e.Header.push({text_id:"field-description",field:"property_description",getCellObject:function(e){return Object(S.jsx)("td",{className:"align-middle",children:e.Description})}}),e.Header.push({text_id:"field-user",field:"property_user",getCellObject:function(e){return Object(S.jsx)("td",{className:"align-middle",children:e.User&&e.User.LinkView})}}),e.Header.push({text_id:"field-date",field:"property_date",sortable:!0,getCellObject:function(e){return Object(S.jsx)("td",{className:"align-middle",children:e.Date.format("L LTS")})}}),e}return a}(Ue),Be=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){var e;return Object(u.a)(this,a),(e=t.call(this)).refreshTable=function(){e.table&&e.table.current&&e.table.current.tryLoadData()},e.filterItems=[new Re(U.Hidden,"id","field-id",{Typing:"Y",PREFIX:"Y"}),new Re(U.UserSelect,"property_user","field-responsible",{Default:"Y"}),new Re(U.DateRange,"property_date","field-date",{NUMBER:"Y"})],e.table=i.a.createRef(),e.filter=i.a.createRef(),e}return Object(d.a)(a,[{key:"render",value:function(){return Object(S.jsxs)("div",{children:[Object(S.jsx)("div",{className:"d-xl-flex mb-3 mt-3",children:Object(S.jsx)(we,{ref:this.filter,id:"filter-log",items:this.filterItems,refreshTable:this.refreshTable})}),Object(S.jsx)(Ye,{ref:this.table,filter:this.filter})]})}}]),a}(i.a.Component),He=a(66),Ke=a.n(He),Je=(i.a.Component,function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){var e;return Object(u.a)(this,a),(e=t.call(this)).onAdminsChange=function(t){e.setState({admins:t})},e.onSubmit=function(){var t=Object(o.a)(l.a.mark((function t(a){var n,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a&&a.preventDefault(),n=Object(h.a)(e),(i=n.state.admins.map((function(e){return e.value}))).length>0&&!i.includes(n.context.getCurrentUser().Id)&&i.push(n.context.getCurrentUser().Id),t.next=6,n.context.setAppSettings("AdminList",i);case 6:return t.next=8,n.context.initAppSettings();case 8:n.refreshData();case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.state={isLoaded:!1,loading:!0,admins:[]},e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.refreshData()}},{key:"refreshData",value:function(){var e=Object(o.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,F.getUsers(this.context.settings.AdminList.Value);case 3:t=e.sent,a=[],this.context.settings.AdminList.Value.forEach((function(e){t[e]&&a.push({value:t[e].Id,label:t[e].FullName})})),this.setState({loading:!1,admins:a},(function(){F.resizeFrame()}));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(S.jsx)("div",{children:Object(S.jsxs)("form",{onSubmit:this.onSubmit,children:[Object(S.jsx)("div",{className:"row mt-4",children:Object(S.jsxs)("div",{className:"col-12 col-lg-8 col-xl-7 col-xxl-6",children:[Object(S.jsx)("div",{children:Object(S.jsx)(A.a,{children:"field-administrators"})}),Object(S.jsx)("div",{className:"form-outline",children:Object(S.jsx)(ae,{value:this.state.admins,onChange:this.onAdminsChange,isMulti:!0})})]})}),!this.loading&&Object(S.jsxs)("div",{className:"mt-4",children:[Object(S.jsx)("button",{type:"submit",className:"btn btn-primary me-2",children:Object(S.jsx)(A.a,{children:"btn-save"})}),Object(S.jsx)(p.b,{to:"/",className:"btn btn-outline-primary",children:Object(S.jsx)(A.a,{children:"btn-cancel"})})]})]})})}}]),a}(i.a.Component));Je.contextType=x;var Ge=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){var e;return Object(u.a)(this,a),(e=t.call(this)).keys=["settings","PropSettingsValue","log","PropLogType","PropLogDate","PropLogUser","PropLogObjectId","PropLogObjectType","PropLogDescription","filter","PropFilterTable","PropFilterData","PropFilterDefault","PropFilterUser","filtersort","PropFilterSortTable","PropFilterSortData","PropFilterSortUser"],e.events=["ONAPPINSTALL","ONAPPUNINSTALL"],e.state={currentCount:0,allCount:e.keys.length},e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.createEntitySettings()}},{key:"componentDidUpdate",value:function(){var e=this;100===e.getPercent()&&e.context.setAppSettings("Version",e.context.appVersion).then((function(){F.installComplete(),e.context.updateComplete()}))}},{key:"getPercent",value:function(){var e=this;return e.state.allCount<1?100:e.state.currentCount/e.state.allCount*100}},{key:"addProgressKey",value:function(e){var t=this;t.setState({currentCount:t.state.currentCount+1},(function(){t.runAfterKey(e)}))}},{key:"runAfterKey",value:function(){var e=Object(o.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this,e.t0=t,e.next="settings"===e.t0?4:"log"===e.t0?6:"filter"===e.t0?8:10;break;case 4:return a.createEntityLog(),e.abrupt("break",10);case 6:return a.createEntityFilter(),e.abrupt("break",10);case 8:return a.createEntityFilterSort(),e.abrupt("break",10);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createEntitySettings",value:function(){var e=je.settings,t={PropSettingsValue:["entity.item.property.add",{ENTITY:e,PROPERTY:"VALUE",NAME:"value",TYPE:"S"}]};this.createEntity(e,t)}},{key:"createEntityLog",value:function(){var e=je.log,t={PropLogType:["entity.item.property.add",{ENTITY:e,PROPERTY:"TYPE",NAME:"type",TYPE:"S"}],PropLogDate:["entity.item.property.add",{ENTITY:e,PROPERTY:"DATE",NAME:"date",TYPE:"N"}],PropLogUser:["entity.item.property.add",{ENTITY:e,PROPERTY:"USER",NAME:"user",TYPE:"N"}],PropLogObjectId:["entity.item.property.add",{ENTITY:e,PROPERTY:"OBJECT_ID",NAME:"object ID",TYPE:"S"}],PropLogObjectType:["entity.item.property.add",{ENTITY:e,PROPERTY:"OBJECT_TYPE",NAME:"object type",TYPE:"S"}],PropLogDescription:["entity.item.property.add",{ENTITY:e,PROPERTY:"DESCRIPTION",NAME:"descrpiption",TYPE:"S"}]};this.createEntity(e,t)}},{key:"createEntityFilter",value:function(){var e=je.filter,t={PropFilterTable:["entity.item.property.add",{ENTITY:e,PROPERTY:"TABLE",NAME:"table id",TYPE:"S"}],PropFilterData:["entity.item.property.add",{ENTITY:e,PROPERTY:"DATA",NAME:"data",TYPE:"S"}],PropFilterDefault:["entity.item.property.add",{ENTITY:e,PROPERTY:"DEFAULT",NAME:"default",TYPE:"S"}],PropFilterUser:["entity.item.property.add",{ENTITY:e,PROPERTY:"USER",NAME:"user",TYPE:"S"}]};this.createEntity(e,t)}},{key:"createEntityFilterSort",value:function(){var e=je.filterSort,t={PropFilterSortTable:["entity.item.property.add",{ENTITY:e,PROPERTY:"TABLE",NAME:"table id",TYPE:"S"}],PropFilterSortData:["entity.item.property.add",{ENTITY:e,PROPERTY:"DATA",NAME:"data",TYPE:"S"}],PropFilterSortUser:["entity.item.property.add",{ENTITY:e,PROPERTY:"USER",NAME:"user",TYPE:"S"}]};this.createEntity(e,t)}},{key:"bindEvents",value:function(){var e=Object(o.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this).eventHandler){e.next=4;break}return t.events.forEach((function(e){t.addProgressKey("EventKey".concat(e))})),e.abrupt("return");case 4:return e.prev=4,a=t.events.slice(),e.next=8,F.callMethod("event.get",{},!0);case 8:e.sent.items.forEach((function(e){var n=a.findIndex((function(t){return e.event===t}));n>-1&&(a.slice(n,1),t.addProgressKey("EventKey".concat(e.event)))})),a.length>0&&(n={},a.forEach((function(e){n["EventKey".concat(e)]=["event.bind",{event:e,handler:t.eventHandler}]})),F.callBatch(n,(function(e){Object.keys(e).forEach((function(a){var n=e[a];n.error()?console.error("error-event-bind",n.error()):t.addProgressKey(a)}))}))),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4),console.error("event.get",e.t0);case 16:case"end":return e.stop()}}),e,this,[[4,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"bindPlacements",value:function(){var e=this;F.callMethod("placement.get").then((function(t){t.items.find((function(e){return"CRM_DEAL_DETAIL_TAB"===e.placement}))&&e.addProgressKey("PlacementDeal")})).catch((function(t){"ACCESS_DENIED"===(t.ex?t.ex:t).error?(console.warn("cant get placement list"),e.addProgressKey("PlacementDeal")):console.error("cant get placement list",t)}))}},{key:"createEntity",value:function(e,t){var a=this;F.callMethod("entity.add",{ENTITY:e,NAME:e,ACCESS:{AU:"X"}}).then((function(n){a.createEntityProperties(e,t)})).catch((function(n){var i=n.ex?n.ex:n;"ERROR_ENTITY_ALREADY_EXISTS"!==i.error?console.error("error-add-storage",e,i):a.createEntityProperties(e,t)}))}},{key:"createEntityProperties",value:function(e,t){var a=this;F.callBatch(t,(function(t){for(var n in t)if(n.startsWith("Prop")){var i=t[n];if(i.error()){var r=i.error().error?i.error():i.error().ex;"ERROR_PROPERTY_ALREADY_EXISTS"!==r.error&&console.error(n,r,i.error())}a.addProgressKey(n)}a.addProgressKey(e)}))}},{key:"render",value:function(){return Object(S.jsx)("div",{children:Object(S.jsx)("div",{className:"progress",children:Object(S.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:this.getPercent()}})})})}}]),a}(i.a.Component);Ge.contextType=x;var Xe=a(57),ze={en:{translation:a(94)},ru:{translation:a(95)}};w.a.use(Xe.d).init({resources:ze,supportedLngs:["en","ru"],fallbackLng:"en",debug:!0,interpolation:{escapeValue:!1}});var We,Qe=w.a;!function(e){e.settings="settings"}(We||(We={}));a(157);var Ze=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){return Object(S.jsxs)(S.Fragment,{children:[Object(S.jsxs)("header",{className:"row",children:[Object(S.jsxs)("div",{className:"col-sm-6 col-lg-6",children:[Object(S.jsx)(p.c,{className:"profile-menu-item pb-3",activeClassName:"profile-menu-item-active",exact:!0,to:"/",children:Object(S.jsx)(A.a,{children:"page-main"})}),this.context.access(We.settings)&&Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(p.c,{className:"profile-menu-item pb-3",activeClassName:"profile-menu-item-active",to:"/log",children:Object(S.jsx)(A.a,{children:"page-log"})}),Object(S.jsx)(p.c,{className:"profile-menu-item pb-3",activeClassName:"profile-menu-item-active",to:"/settings",children:Object(S.jsx)(A.a,{children:"page-settings"})})]})]}),Object(S.jsxs)("div",{className:"col-sm-6 col-lg-6 d-flex flex-row-reverse header-right-buttons",children:[Object(S.jsxs)("a",{href:"https://google.com",target:"_blank",children:[Object(S.jsx)("a",{className:"btn btn-success btn-md btn-floating me-1",role:"button",children:Object(S.jsx)("i",{className:"fas fa-shopping-cart"})}),Object(S.jsx)(A.a,{children:"btn-rates"})]}),Object(S.jsxs)("a",{href:"https://google.com",target:"_blank",className:"me-2",children:[Object(S.jsx)("a",{className:"btn btn-warning btn-md btn-floating me-1",role:"button",children:Object(S.jsx)("i",{className:"fas fa-dollar-sign"})}),Object(S.jsx)(A.a,{children:"btn-buy"})]}),Object(S.jsxs)("a",{href:"https://google.com",target:"_blank",className:"me-2",children:[Object(S.jsx)("a",{className:"btn btn-info btn-md btn-floating me-1",role:"button",children:Object(S.jsx)("i",{className:"fas fa-question"})}),Object(S.jsx)(A.a,{children:"btn-help"})]})]})]}),Object(S.jsx)("hr",{className:"mt-0 mb-4"})]})}}]),a}(i.a.Component);Ze.contextType=x;var $e=Ze,et=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){var e;return Object(u.a)(this,a),(e=t.call(this)).setAppSettings=function(){var t=Object(o.a)(l.a.mark((function t(a,n){var i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i={ENTITY:je.settings,NAME:a,ID:"",PROPERTY_VALUES:{VALUE:JSON.stringify(n)}},!e.state.settingsCache[a]){t.next=9;break}return i.ID=e.state.settingsCache[a].ID,t.next=5,F.callMethod("entity.item.update",i);case 5:return t.sent,t.abrupt("return",!0);case 9:return t.next=11,F.callMethod("entity.item.add",i);case 11:return t.sent,t.abrupt("return",!0);case 13:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.initAppSettings=function(){var t=Object(h.a)(e);return new Promise((function(e,a){t.setState({settingsCache:{}},Object(o.a)(l.a.mark((function a(){var n;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.getAppSettingsCache();case 2:n={},t.DefaultSettings.forEach((function(e){var a=t.getAppSettings(e.Key);n[e.Key]=new tt(e.Key,a||e.Default(),e.Default,e.SaveInSettings)})),t.setState({settings:n},(function(){e(!0)}));case 5:case"end":return a.stop()}}),a)}))))}))},e.getAppSettingsCache=Object(o.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={},t.prev=1,t.next=4,F.callMethod("entity.item.get",{ENTITY:je.settings},!0);case 4:t.sent.items.forEach((function(e){a[e.NAME]=e})),e.setState({settingsCache:a}),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),console.error("getAppSettingsCache",t.t0),e.setNeedUpdate();case 13:case"end":return t.stop()}}),t,null,[[1,9]])}))),e.getAppSettings=function(t){return!!e.state.settingsCache[t]&&ge.tryParseJson(e.state.settingsCache[t].PROPERTY_VALUES.VALUE)},e.updateComplete=function(){e.setState({needUpdate:!1})},e.access=function(t){var a=e.state.currentUser||null;if(!a)return!1;switch(t){case We.settings:return!(!e.state.settings||!e.state.settings.AdminList.Value.includes(a.Id))||a.isAdmin}return a.isAdmin},e.getCurrentUser=function(){return e.state.currentUser},e.setHeaderVisibility=function(t){e.setState({headerVisibility:t})},e.state={appVersion:1,settingsCache:{},settings:{},loading:!0,needUpdate:!1,headerVisibility:!0},e.DefaultSettings=[new tt("AdminList","",(function(){return[]})),new tt("Version","",(function(){return 0}),!1)],j.a.setAppElement("#root"),e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.init()}},{key:"init",value:function(){var e=Object(o.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.prev=1,e.next=4,F.init();case 4:a=e.sent,O.a.locale(F.getLang()),Qe.changeLanguage(F.getLang()),t.setState({currentUser:a},Object(o.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.initAppSettings();case 2:if(t.setState({loading:!1}),parseInt(t.state.settings.Version.Value)===t.state.appVersion){e.next=7;break}t.setNeedUpdate(),e.next=9;break;case 7:return e.next=9,t.tryCheckInstall();case 9:case"end":return e.stop()}}),e)})))),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),t.setState({loading:!1});case 13:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"setNeedUpdate",value:function(){this.setState({needUpdate:!0})}},{key:"tryCheckInstall",value:function(){var e=Object(o.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.callMethod("app.info");case 3:if(!((t=e.sent).items&&t.items.length>0)){e.next=9;break}if(t.items[0].INSTALLED){e.next=8;break}return this.setNeedUpdate(),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(0),console.error("tryCheckInstall",e.t0),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.loading?Object(S.jsx)("div",{className:"app container-fluid my-2",children:Object(S.jsx)("div",{className:"text-center",children:Object(S.jsx)(Me,{})})}):F.isInitComplete()?Object(S.jsx)(x.Provider,{value:{appVersion:this.state.appVersion,getCurrentUser:this.getCurrentUser,settings:this.state.settings,initAppSettings:this.initAppSettings,setAppSettings:this.setAppSettings,updateComplete:this.updateComplete,access:this.access,setHeaderVisibility:this.setHeaderVisibility},children:Object(S.jsx)(p.a,{children:Object(S.jsxs)("div",{className:"app container-fluid my-2",children:[!this.state.loading&&!this.state.needUpdate&&Object(S.jsxs)(S.Fragment,{children:[this.state.headerVisibility&&Object(S.jsx)($e,{}),Object(S.jsxs)(v.c,{children:[Object(S.jsx)(v.a,{path:"/log",component:Be}),Object(S.jsx)(v.a,{path:"/settings",component:Je}),Object(S.jsx)(v.a,{path:"/",component:C})]})]}),this.state.needUpdate&&Object(S.jsx)(Ge,{})]})})}):Object(S.jsx)("div",{className:"app container-fluid my-2",children:"This is Sparta! (not bitrix)"})}}]),a}(i.a.Component),tt=function e(t,a,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];Object(u.a)(this,e),this.Key=t,this.Value=a,this.Default=n,this.SaveStatus=!0,this.SaveInSettings=i},at=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,167)).then((function(t){var a=t.getCLS,n=t.getFID,i=t.getFCP,r=t.getLCP,s=t.getTTFB;a(e),n(e),i(e),r(e),s(e)}))};a(158),a(159),a(160),a(161);s.a.render(Object(S.jsx)(i.a.StrictMode,{children:Object(S.jsx)(et,{})}),document.getElementById("root")),at()},94:function(e){e.exports=JSON.parse('{"page-log":"Log","page-settings":"Settings"}')},95:function(e){e.exports=JSON.parse('{"page-log":"\u0416\u0443\u0440\u043d\u0430\u043b \u0441\u043e\u0431\u044b\u0442\u0438\u0439","page-settings":"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"}')}},[[162,1,2]]]);
//# sourceMappingURL=main.596d6e4a.chunk.js.map